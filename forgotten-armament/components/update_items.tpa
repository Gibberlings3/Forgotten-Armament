// Forgotten Armament - Update Existing Items

/*************************************************************************/
///////////////////////////////////////////////////////////////////////////
// UPDATE MELEE WEAPONS                                                  //
///////////////////////////////////////////////////////////////////////////
/*************************************************************************/

///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
// Axe                                                                   //
///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////
// Mauletar +2                                                           //
// Fear Immunity                                                         //
///////////////////////////////////////////////////////////////////////////
ACTION_IF FILE_EXISTS_IN_GAME ~AX1H03.ITM~ BEGIN
    COPY ~forgotten-armament/itm/update/AX1H03.ITM~ ~override~
        SAY NAME1 @10000
        SAY NAME2 @30000
        SAY UNIDENTIFIED_DESC @10001
        SAY DESC @30001
END

///////////////////////////////////////////////////////////////////////////
// Azuredge                                                              //
///////////////////////////////////////////////////////////////////////////
ACTION_IF FILE_EXISTS_IN_GAME ~AX1H10.ITM~ BEGIN
    COPY ~forgotten-armament/itm/update/AX1H10.ITM~ ~override~
END

///////////////////////////////////////////////////////////////////////////
// Frostreaver +3                                                        //
// +2 cold and acid damage (previously +1)                               //
///////////////////////////////////////////////////////////////////////////
ACTION_IF FILE_EXISTS_IN_GAME ~AX1H13.ITM~ BEGIN
OUTER_SPRINT oldaxe1 @30002
OUTER_SPRINT newaxe1 @30003

    COPY_EXISTING ~AX1H13.ITM~ ~override~
      LPF ALTER_ITEM_EFFECT INT_VAR check_headers = 1 match_opcode = 12 parameter1 = 2 END

      READ_LONG 0x54 desc_strref
          PATCH_IF (desc_strref >= 0 && desc_strref < 2147483646) BEGIN
            READ_STRREF 0x54 desc
            INNER_PATCH_SAVE desc ~%desc%~ BEGIN
              REPLACE_TEXTUALLY ~%oldaxe1%~ ~%newaxe1%~
            END
            SAY_EVALUATED 0x54 ~%desc%~
          END
END

///////////////////////////////////////////////////////////////////////////
// Stonefire +3                                                          //
// +1d6 fire damage (previously +2)                                      //
///////////////////////////////////////////////////////////////////////////
ACTION_IF FILE_EXISTS_IN_GAME ~AX1H12.ITM~ BEGIN
OUTER_SPRINT oldaxe2 @30004
OUTER_SPRINT newaxe2 @30005

    COPY_EXISTING ~AX1H12.ITM~ ~override~
      LPF ALTER_ITEM_EFFECT INT_VAR check_headers = 1 match_opcode = 12 parameter1 = 0 dicenumber = 1 dicesize = 6 END

      READ_LONG 0x54 desc_strref
          PATCH_IF (desc_strref >= 0 && desc_strref < 2147483646) BEGIN
            READ_STRREF 0x54 desc
            INNER_PATCH_SAVE desc ~%desc%~ BEGIN
              REPLACE_TEXTUALLY ~%oldaxe2%~ ~%newaxe2%~
            END
            SAY_EVALUATED 0x54 ~%desc%~
          END
END

///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
// Bastard Sword                                                         //
///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////
// Blade of Searing +3                                                   //
// +1d6 fire damage (previously +1)                                      //
///////////////////////////////////////////////////////////////////////////
ACTION_IF FILE_EXISTS_IN_GAME ~SW1H39.ITM~ BEGIN
OUTER_SPRINT oldbast1 @30100
OUTER_SPRINT newbast1 @30101

    COPY_EXISTING ~SW1H39.ITM~ ~override~
      LPF ALTER_ITEM_EFFECT INT_VAR check_headers = 1 match_opcode = 12 parameter1 = 0 dicenumber = 1 dicesize = 6 END

      READ_LONG 0x54 desc_strref
          PATCH_IF (desc_strref >= 0 && desc_strref < 2147483646) BEGIN
            READ_STRREF 0x54 desc
            INNER_PATCH_SAVE desc ~%desc%~ BEGIN
              REPLACE_TEXTUALLY ~%oldbast1%~ ~%newbast1%~
            END
            SAY_EVALUATED 0x54 ~%desc%~
          END
END

///////////////////////////////////////////////////////////////////////////
// Kondar                                                                //
//                                                                       //
///////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////
// Purifier +4                                                           //
//                                                                       //
///////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////
// Purifier +5                                                           //
//                                                                       //
///////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
// Club                                                                  //
///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////
// Bone Club vs. Undead                                                  //
// +5 enchantment vs Undead (previously +3) w/ +10 extra damage to Undead//
///////////////////////////////////////////////////////////////////////////
ACTION_IF FILE_EXISTS_IN_GAME ~BLUN23.ITM~ BEGIN
COPY ~forgotten-armament/eff/update_item/MOBL231.EFF~ ~override~
COPY ~forgotten-armament/eff/update_item/MOBL232.EFF~ ~override~
OUTER_SPRINT oldclub1 @30200
OUTER_SPRINT newclub1 @30201
OUTER_SPRINT oldclub2 @30202
OUTER_SPRINT newclub2 @30203

    COPY_EXISTING ~BLUN23.ITM~ ~override~
      LPF ALTER_ITEM_EFFECT INT_VAR check_globals = 1 match_opcode = 344 special = 5 END
      LPF ALTER_ITEM_EFFECT INT_VAR check_globals = 1 match_opcode = 177 STR_VAR resource = ~mobln232~ END
      LPF ALTER_ITEM_EFFECT INT_VAR check_headers = 1 match_opcode = 177 STR_VAR resource = ~mobln231~ END

      READ_LONG 0x54 desc_strref
          PATCH_IF (desc_strref >= 0 && desc_strref < 2147483646) BEGIN
            READ_STRREF 0x54 desc
            INNER_PATCH_SAVE desc ~%desc%~ BEGIN
              REPLACE_TEXTUALLY ~%oldclub1%~ ~%newclub1%~
              REPLACE_TEXTUALLY ~%oldclub2%~ ~%newclub2%~
            END
            SAY_EVALUATED 0x54 ~%desc%~
          END

      READ_LONG 0xc desc_strref
          PATCH_IF (desc_strref >= 0 && desc_strref < 2147483646) BEGIN
            READ_STRREF 0xc desc
            INNER_PATCH_SAVE desc ~%desc%~ BEGIN
              REPLACE_TEXTUALLY ~%oldclub2%~ ~%newclub2%~
            END
            SAY_EVALUATED 0xc ~%desc%~
          END
END

///////////////////////////////////////////////////////////////////////////
// Club of Detonation +3                                                 //
// +20% Fire Resistance                                                  //
///////////////////////////////////////////////////////////////////////////
ACTION_IF FILE_EXISTS_IN_GAME ~BLUN26.ITM~ BEGIN
OUTER_SPRINT oldclub3 @30204
OUTER_SPRINT newclub3 @30205
    
    COPY_EXISTING ~BLUN26.ITM~ ~override~
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 30 target = 1 parameter1 = 20 parameter2 = 0 timing = 2 resist_dispel = 0 probability1 = 100 END
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 142 target = 1 parameter2 = 16 timing = 2 resist_dispel = 0 probability1 = 100 END

      READ_LONG 0x54 desc_strref
          PATCH_IF (desc_strref >= 0 && desc_strref < 2147483646) BEGIN
            READ_STRREF 0x54 desc
            INNER_PATCH_SAVE desc ~%desc%~ BEGIN
              REPLACE_TEXTUALLY ~%oldclub3%~ ~%newclub3%~
            END
            SAY_EVALUATED 0x54 ~%desc%~
          END 
END

///////////////////////////////////////////////////////////////////////////
// Club of Detonation +5                                                 //
// +50% Fire Resistance, 10% chance per hit for fireball (previously 5%) //
///////////////////////////////////////////////////////////////////////////
ACTION_IF FILE_EXISTS_IN_GAME ~BLUN27.ITM~ BEGIN
OUTER_SPRINT oldclub4 @30206
OUTER_SPRINT newclub4 @30207
OUTER_SPRINT oldclub5 @30208
OUTER_SPRINT newclub5 @30209
    
    COPY_EXISTING ~BLUN27.ITM~ ~override~
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 30 target = 1 parameter1 = 50 parameter2 = 0 timing = 2 resist_dispel = 0 probability1 = 100 END
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 142 target = 1 parameter2 = 16 timing = 2 resist_dispel = 0 probability1 = 100 END
      LPF ALTER_ITEM_EFFECT INT_VAR check_headers = 1 match_opcode = 146 probability2 = 90 END
      //LPF ALTER_ITEM_EFFECT INT_VAR check_headers = 1 match_opcode = 12 match_probability1 = 30 probability1 = 29 END

      READ_LONG 0x54 desc_strref
          PATCH_IF (desc_strref >= 0 && desc_strref < 2147483646) BEGIN
            READ_STRREF 0x54 desc
            INNER_PATCH_SAVE desc ~%desc%~ BEGIN
              REPLACE_TEXTUALLY ~%oldclub4%~ ~%newclub4%~
              REPLACE_TEXTUALLY ~%oldclub5%~ ~%newclub5%~
            END
            SAY_EVALUATED 0x54 ~%desc%~
          END 
END

///////////////////////////////////////////////////////////////////////////
// Blackblood +3                                                         //
// +1d6 acid damage (previously +3)                                      //
///////////////////////////////////////////////////////////////////////////
ACTION_IF FILE_EXISTS_IN_GAME ~BLUN22.ITM~ BEGIN
OUTER_SPRINT oldclub6 @30210
OUTER_SPRINT newclub6 @30211
    
    COPY_EXISTING ~BLUN22.ITM~ ~override~
      LPF ALTER_ITEM_EFFECT INT_VAR check_headers = 1 match_opcode = 12 parameter1 = 0 dicenumber = 1 dicesize = 6 END

      READ_LONG 0x54 desc_strref
          PATCH_IF (desc_strref >= 0 && desc_strref < 2147483646) BEGIN
            READ_STRREF 0x54 desc
            INNER_PATCH_SAVE desc ~%desc%~ BEGIN
              REPLACE_TEXTUALLY ~%oldclub6%~ ~%newclub6%~
            END
            SAY_EVALUATED 0x54 ~%desc%~
          END 
END

///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
// Dagger                                                                //
///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////
// Dagger of <CHARNAME>                                                  //
///////////////////////////////////////////////////////////////////////////
ACTION_IF FILE_EXISTS_IN_GAME ~DAGG19.ITM~ BEGIN
OUTER_SPRINT olddagger1 @30300
OUTER_SPRINT newdagger1 @30301
OUTER_SPRINT olddagger2 @30302
OUTER_SPRINT newdagger2 @30303

    COPY_EXISTING ~DAGG19.ITM~ ~override~
        WRITE_LONG 0x60 2
        LPF ALTER_ITEM_HEADER INT_VAR header_type=1 thac0_bonus = 2 damage_bonus = 2 END
        LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 142 target = 1 parameter2 = 63 timing = 2 resist_dispel = 2 probability1 = 100 END 
        LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 166 target = 1 parameter1 = 10 parameter2 = 0 timing = 2 resist_dispel = 0 probability1 = 100 END 
        LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 42 target = 1 parameter1 = 10 parameter2 = 2 timing = 2 resist_dispel = 0 probability1 = 100 END
        LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 42 target = 1 parameter1 = 10 parameter2 = 1 timing = 2 resist_dispel = 0 probability1 = 100 END
        LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 42 target = 1 parameter1 = 10 parameter2 = 0 timing = 2 resist_dispel = 0 probability1 = 100 END 

        READ_LONG 0x50 desc_strref
          PATCH_IF (desc_strref >= 0 && desc_strref < 2147483646) BEGIN
            READ_STRREF 0x50 desc
            INNER_PATCH_SAVE desc ~%desc%~ BEGIN
              REPLACE_TEXTUALLY ~%olddagger1%~ ~%newdagger1%~
              REPLACE_TEXTUALLY ~%olddagger2%~ ~%newdagger2%~
            END
            SAY_EVALUATED 0x50 ~%desc%~
          END
END

///////////////////////////////////////////////////////////////////////////
// Ice Talon +2                                                          //
// +1d4 cold damage (previously +1)                                      //
///////////////////////////////////////////////////////////////////////////
ACTION_IF FILE_EXISTS_IN_GAME ~MODAG02.ITM~ BEGIN
OUTER_SPRINT olddagger3 @30304
OUTER_SPRINT newdagger3 @30305

    COPY_EXISTING ~MODAG02.ITM~ ~override~
      LPF ALTER_ITEM_EFFECT INT_VAR check_headers = 1 match_opcode = 12 parameter1 = 0 dicenumber = 1 dicesize = 4 END

      READ_LONG 0x54 desc_strref
          PATCH_IF (desc_strref >= 0 && desc_strref < 2147483646) BEGIN
            READ_STRREF 0x54 desc
            INNER_PATCH_SAVE desc ~%desc%~ BEGIN
              REPLACE_TEXTUALLY ~%olddagger3%~ ~%newdagger3%~
            END
            SAY_EVALUATED 0x54 ~%desc%~
          END
END

///////////////////////////////////////////////////////////////////////////
// Boneblade +4                                                          //
///////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////
// Heart of the Golem +2                                                 //
///////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////
// The Grave Binder +2                                                   //
///////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
// Flails                                                                //
///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////
// Flail of Ages +5                                                      //
// Remove Magic Resistance and Free Action                               //
///////////////////////////////////////////////////////////////////////////
ACTION_IF FILE_EXISTS_IN_GAME ~BLUN30.ITM~ BEGIN
OUTER_SPRINT oldflail01 @30400

    COPY_EXISTING ~BLUN30.ITM~ ~override~
        LPF DELETE_ITEM_EQEFFECT INT_VAR opcode_to_delete = 46 END
        LPF DELETE_ITEM_EQEFFECT INT_VAR opcode_to_delete = 267 END
        LPF DELETE_ITEM_EQEFFECT INT_VAR opcode_to_delete = 142 END
        LPF DELETE_ITEM_EQEFFECT INT_VAR opcode_to_delete = 163 END
        LPF DELETE_ITEM_EQEFFECT INT_VAR opcode_to_delete = 101 END
        LPF DELETE_ITEM_EQEFFECT INT_VAR opcode_to_delete = 296 END
        LPF DELETE_ITEM_EQEFFECT INT_VAR opcode_to_delete = 166 END
        LPF DELETE_ITEM_EQEFFECT INT_VAR opcode_to_delete = 126 END
        LPF DELETE_ITEM_EQEFFECT INT_VAR opcode_to_delete = 169 END
        LPF DELETE_ITEM_EQEFFECT INT_VAR opcode_to_delete = 206 END
        LPF DELETE_ITEM_EQEFFECT INT_VAR opcode_to_delete = 162 END
        LPF DELETE_ITEM_EQEFFECT INT_VAR opcode_to_delete = 240 END

        READ_LONG 0x54 desc_strref
          PATCH_IF (desc_strref >= 0 && desc_strref < 2147483646) BEGIN
            READ_STRREF 0x54 desc
            INNER_PATCH_SAVE desc ~%desc%~ BEGIN
              REPLACE_TEXTUALLY ~%oldflail01%~ ~~
            END
            SAY_EVALUATED 0x54 ~%desc%~
          END
END

///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
// Halberd                                                               //
///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////
// Suryris Blade                                                         //
// 25% chance of kocking down an opponent                                //
///////////////////////////////////////////////////////////////////////////
ACTION_IF FILE_EXISTS_IN_GAME ~HALB03.ITM~ BEGIN
OUTER_SPRINT oldhalb1 @30500
OUTER_SPRINT newhalb1 @30501

    COPY_EXISTING ~HALB03.ITM~ ~override~
        LPF ADD_ITEM_EFFECT INT_VAR type = 1 opcode = 39 target = 2 parameter2 = 1 timing = 0 resist_dispel = 2 duration = 3 probability1 = 24 savingthrow = 4 special = 14 END

        READ_LONG 0x54 desc_strref
          PATCH_IF (desc_strref >= 0 && desc_strref < 2147483646) BEGIN
            READ_STRREF 0x54 desc
            INNER_PATCH_SAVE desc ~%desc%~ BEGIN
              REPLACE_TEXTUALLY ~%oldhalb1%~ ~%newhalb1%~
            END
            SAY_EVALUATED 0x54 ~%desc%~
          END
END

///////////////////////////////////////////////////////////////////////////
// Dragon's Breath +4                                                    //
// 1d10 +4 damage (previously just 1d10)                                 //
///////////////////////////////////////////////////////////////////////////
ACTION_IF FILE_EXISTS_IN_GAME ~HALB05.ITM~ BEGIN
OUTER_SPRINT oldhalb2 @30502
OUTER_SPRINT newhalb2 @30503

    COPY_EXISTING ~HALB05.ITM~ ~override~
        LPF ALTER_ITEM_HEADER INT_VAR header_type=1 damage_bonus = 4 END

        READ_LONG 0x54 desc_strref
          PATCH_IF (desc_strref >= 0 && desc_strref < 2147483646) BEGIN
            READ_STRREF 0x54 desc
            INNER_PATCH_SAVE desc ~%desc%~ BEGIN
              REPLACE_TEXTUALLY ~%oldhalb2%~ ~%newhalb2%~
            END
            SAY_EVALUATED 0x54 ~%desc%~
          END
END

///////////////////////////////////////////////////////////////////////////
// Duskblade                                                             //
// +3 item (previously +2), +1d6 cold damage (previously +2)             //
///////////////////////////////////////////////////////////////////////////
ACTION_IF FILE_EXISTS_IN_GAME ~HALB08.ITM~ BEGIN
OUTER_SPRINT oldhalb3 @30504
OUTER_SPRINT newhalb3 @30505
OUTER_SPRINT oldhalb4 @30506
OUTER_SPRINT newhalb4 @30507

    COPY_EXISTING ~HALB08.ITM~ ~override~
      WRITE_LONG 0x60 3
      LPF ALTER_ITEM_HEADER INT_VAR header_type=1 thac0_bonus = 3 damage_bonus = 3 END
      LPF ALTER_ITEM_EFFECT INT_VAR match_opcode = 12 check_headers = 1 parameter1 = 0 dicenumber = 1 dicesize = 6 END

        PATCH_FOR_EACH offset IN 0xc 0x54 BEGIN
        READ_LONG ~%offset%~ desc_strref
            PATCH_IF (desc_strref >= 0 && desc_strref < 2147483646) BEGIN
              READ_STRREF ~%offset%~ desc
              INNER_PATCH_SAVE desc ~%desc%~ BEGIN
                REPLACE_TEXTUALLY ~%oldhalb3%~ ~%newhalb3%~
                REPLACE_TEXTUALLY ~%oldhalb4%~ ~%newhalb4%~
              END
              SAY_EVALUATED ~%offset%~ ~%desc%~
            END
      END
END

///////////////////////////////////////////////////////////////////////////
// The Wave +4                                                           //
// 50% chance of draining (previously 15%)                               //
///////////////////////////////////////////////////////////////////////////
ACTION_IF FILE_EXISTS_IN_GAME ~HALB09.ITM~ BEGIN
OUTER_SPRINT oldhalb5 @30508
OUTER_SPRINT newhalb5 @30509

    COPY_EXISTING ~HALB09.ITM~ ~override~
        LPF ALTER_ITEM_EFFECT INT_VAR match_opcode = 12 check_headers = 1 probability1 = 49 END

        READ_LONG 0x54 desc_strref
          PATCH_IF (desc_strref >= 0 && desc_strref < 2147483646) BEGIN
            READ_STRREF 0x54 desc
            INNER_PATCH_SAVE desc ~%desc%~ BEGIN
              REPLACE_TEXTUALLY ~%oldhalb5%~ ~%newhalb5%~
            END
            SAY_EVALUATED 0x54 ~%desc%~
          END
END

///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
// Katana                                                                //
///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////
// Crimson Dawn                                                          //
// +3 item                                                               //
///////////////////////////////////////////////////////////////////////////
ACTION_IF FILE_EXISTS_IN_GAME ~BDSW1H01.ITM~ BEGIN
OUTER_SPRINT oldkata4 @30606
OUTER_SPRINT newkata4 @30607

    COPY_EXISTING ~BDSW1H01.ITM~ ~override~
      WRITE_LONG 0x60 3
      LPF ALTER_ITEM_HEADER INT_VAR header_type=1 thac0_bonus = 3 damage_bonus = 3 END

      PATCH_FOR_EACH offset IN 0xc 0x54 BEGIN
        READ_LONG ~%offset%~ desc_strref
            PATCH_IF (desc_strref >= 0 && desc_strref < 2147483646) BEGIN
              READ_STRREF ~%offset%~ desc
              INNER_PATCH_SAVE desc ~%desc%~ BEGIN
                REPLACE_TEXTUALLY ~%oldkata4%~ ~%newkata4%~
              END
              SAY_EVALUATED ~%offset%~ ~%desc%~
            END
      END
END

///////////////////////////////////////////////////////////////////////////
// Hindo's Doom +3                                                       //
// 2d10+6 vs undead                                                      //
///////////////////////////////////////////////////////////////////////////
ACTION_IF FILE_EXISTS_IN_GAME ~SW1H70.ITM~ BEGIN
COPY ~forgotten-armament/eff/update_item/MO1H70.EFF~ ~override~
OUTER_SPRINT oldkata1 @30600
OUTER_SPRINT newkata1 @30601
    
    COPY_EXISTING ~SW1H70.ITM~ ~override~
        LPF ADD_ITEM_EFFECT INT_VAR opcode = 177 type = 1 target = 2 parameter1 = 4 parameter2 = 3 timing = 1 resist_dispel = 0 probability1 = 100 STR_VAR resource = ~mo1h70~ END

        READ_LONG 0x54 desc_strref
          PATCH_IF (desc_strref >= 0 && desc_strref < 2147483646) BEGIN
            READ_STRREF 0x54 desc
            INNER_PATCH_SAVE desc ~%desc%~ BEGIN
              REPLACE_TEXTUALLY ~%oldkata1%~ ~%newkata1%~
            END
            SAY_EVALUATED 0x54 ~%desc%~
          END
END

///////////////////////////////////////////////////////////////////////////
// Hindo's Doom +4                                                       //
// 2d10+8 vs undead, save vs -4 or be destroyed                          //
///////////////////////////////////////////////////////////////////////////
ACTION_IF FILE_EXISTS_IN_GAME ~SW1H71.ITM~ BEGIN
COPY ~forgotten-armament/eff/update_item/MO1H71.EFF~ ~override~
OUTER_SPRINT oldkata2 @30602
OUTER_SPRINT newkata2 @30603
OUTER_SPRINT oldkata3 @30604
OUTER_SPRINT newkata3 @30605
    
    COPY_EXISTING ~SW1H71.ITM~ ~override~
        LPF ADD_ITEM_EFFECT INT_VAR opcode = 177 type = 1 target = 2 parameter1 = 4 parameter2 = 3 timing = 1 resist_dispel = 0 probability1 = 100 STR_VAR resource = ~mesdie~ END
        LPF ADD_ITEM_EFFECT INT_VAR opcode = 177 type = 1 target = 2 parameter1 = 4 parameter2 = 3 timing = 1 resist_dispel = 0 probability1 = 100 STR_VAR resource = ~die~ END
        LPF ADD_ITEM_EFFECT INT_VAR opcode = 177 type = 1 target = 2 parameter1 = 4 parameter2 = 3 timing = 1 resist_dispel = 0 probability1 = 100 STR_VAR resource = ~mo1h71~ END

        READ_LONG 0x54 desc_strref
          PATCH_IF (desc_strref >= 0 && desc_strref < 2147483646) BEGIN
            READ_STRREF 0x54 desc
            INNER_PATCH_SAVE desc ~%desc%~ BEGIN
              REPLACE_TEXTUALLY ~%oldkata2%~ ~%newkata2%~
              REPLACE_TEXTUALLY ~%oldkata3%~ ~%newkata3%~
            END
            SAY_EVALUATED 0x54 ~%desc%~
          END
END

///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
// Long Sword                                                            //
///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////
// Blackrazor                                                            //
// +4 weapon                                                             //
///////////////////////////////////////////////////////////////////////////
ACTION_IF FILE_EXISTS_IN_GAME ~MISCBC.ITM~ BEGIN

    COPY_EXISTING ~MISCBC.ITM~ ~override\MOBLK01.ITM~
      WRITE_LONG 0x60 4
      LPF ALTER_ITEM_HEADER INT_VAR header_type=1 thac0_bonus = 4 damage_bonus = 4 END
      LPF ALTER_ITEM_EFFECT INT_VAR match_opcode = ~-1~ check_headers = 1 probability1 = 24 END
      SAY NAME1 @30700
      SAY NAME2 @30700
      SAY DESC  @30701
END

///////////////////////////////////////////////////////////////////////////
// Daystar                                                               //
// +3 weapon                                                             //
///////////////////////////////////////////////////////////////////////////
ACTION_IF FILE_EXISTS_IN_GAME ~SW1H31.ITM~ BEGIN
OUTER_SPRINT oldlong2 @30702
OUTER_SPRINT newlong2 @30703

    COPY_EXISTING ~SW1H31.ITM~ ~override~
      WRITE_LONG 0x60 3
      LPF ALTER_ITEM_HEADER INT_VAR header_type=1 thac0_bonus = 3 damage_bonus = 3 END

      PATCH_FOR_EACH offset IN 0xc 0x54 BEGIN
        READ_LONG ~%offset%~ desc_strref
            PATCH_IF (desc_strref >= 0 && desc_strref < 2147483646) BEGIN
              READ_STRREF ~%offset%~ desc
              INNER_PATCH_SAVE desc ~%desc%~ BEGIN
                REPLACE_TEXTUALLY ~%oldlong2%~ ~%newlong2%~
              END
              SAY_EVALUATED ~%offset%~ ~%desc%~
            END
      END
END

///////////////////////////////////////////////////////////////////////////
// Angurvadal +5                                                         //
// 2d4+1 fire damage (previously 1d4+1)                                  //
///////////////////////////////////////////////////////////////////////////
ACTION_IF FILE_EXISTS_IN_GAME ~SW1H61.ITM~ BEGIN
OUTER_SPRINT oldlong3 @30704
OUTER_SPRINT newlong3 @30705

    COPY_EXISTING ~SW1H61.ITM~ ~override~
      LPF ALTER_ITEM_EFFECT INT_VAR match_opcode = 12 check_headers = 1 dicenumber = 2 END

      READ_LONG 0x54 desc_strref
          PATCH_IF (desc_strref >= 0 && desc_strref < 2147483646) BEGIN
            READ_STRREF 0x54 desc
            INNER_PATCH_SAVE desc ~%desc%~ BEGIN
              REPLACE_TEXTUALLY ~%oldlong3%~ ~%newlong3%~
            END
            SAY_EVALUATED 0x54 ~%desc%~
          END
END

///////////////////////////////////////////////////////////////////////////
// Angurvadal +4                                                         //
// +1d8 fire damage (previously +1)                                      //
///////////////////////////////////////////////////////////////////////////
ACTION_IF FILE_EXISTS_IN_GAME ~SW1H60.ITM~ BEGIN
OUTER_SPRINT oldlong4 @30706
OUTER_SPRINT newlong4 @30707

    COPY_EXISTING ~SW1H60.ITM~ ~override~
      LPF ALTER_ITEM_EFFECT INT_VAR check_headers = 1 match_opcode = 12 parameter1 = 0 dicenumber = 1 dicesize = 8 END

      READ_LONG 0x54 desc_strref
          PATCH_IF (desc_strref >= 0 && desc_strref < 2147483646) BEGIN
            READ_STRREF 0x54 desc
            INNER_PATCH_SAVE desc ~%desc%~ BEGIN
              REPLACE_TEXTUALLY ~%oldlong4%~ ~%newlong4%~
            END
            SAY_EVALUATED 0x54 ~%desc%~
          END
END

///////////////////////////////////////////////////////////////////////////
// Varscona +2                                                           //
// +1d4 cold damage (previously +1)                                      //
///////////////////////////////////////////////////////////////////////////
ACTION_IF FILE_EXISTS_IN_GAME ~SW1H06.ITM~ BEGIN
OUTER_SPRINT oldlong5 @30708
OUTER_SPRINT newlong5 @30709

    COPY_EXISTING ~SW1H06.ITM~ ~override~
      LPF ALTER_ITEM_EFFECT INT_VAR check_headers = 1 match_opcode = 12 parameter1 = 0 dicenumber = 1 dicesize = 4 END

      READ_LONG 0x54 desc_strref
          PATCH_IF (desc_strref >= 0 && desc_strref < 2147483646) BEGIN
            READ_STRREF 0x54 desc
            INNER_PATCH_SAVE desc ~%desc%~ BEGIN
              REPLACE_TEXTUALLY ~%oldlong5%~ ~%newlong5%~
            END
            SAY_EVALUATED 0x54 ~%desc%~
          END
END

///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
// Mace                                                                  //
///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////
// Ardulia's Fall                                                        //
// Better save vs hit, +3 weapon, +2 wisdom                              //
///////////////////////////////////////////////////////////////////////////
ACTION_IF FILE_EXISTS_IN_GAME ~BLUN20.ITM~ BEGIN
OUTER_SPRINT oldmace1 @30800
OUTER_SPRINT newmace1 @30801
OUTER_SPRINT oldmace2 @30802
OUTER_SPRINT newmace2 @30803
OUTER_SPRINT oldmace3 @30804
OUTER_SPRINT newmace3 @30805
OUTER_SPRINT oldmace5 @30808
OUTER_SPRINT newmace5 @30809

    COPY_EXISTING ~BLUN20.ITM~ ~override~
      WRITE_LONG 0x60 3
      LPF ALTER_ITEM_HEADER INT_VAR header_type=1 thac0_bonus = 3 damage_bonus = 3 END
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 49 target = 1 parameter1 = 2 parameter2 = 0 timing = 2 resist_dispel = 2 probability1 = 100 END
      LPF ALTER_ITEM_EFFECT INT_VAR match_opcode = 0 check_headers = 1 savebonus = ~-2~ END
      LPF ALTER_ITEM_EFFECT INT_VAR match_opcode = 54 check_headers = 1 savebonus = ~-2~ END
      LPF ALTER_ITEM_EFFECT INT_VAR match_opcode = 142 check_headers = 1 savebonus = ~-2~ END
      LPF ALTER_ITEM_EFFECT INT_VAR match_opcode = 139 check_headers = 1 savebonus = ~-2~ END
      LPF ALTER_ITEM_EFFECT INT_VAR match_opcode = 141 check_headers = 1 savebonus = ~-2~ END
      LPF ALTER_ITEM_EFFECT INT_VAR match_opcode = 174 check_headers = 1 savebonus = ~-2~ END
      LPF ALTER_ITEM_EFFECT INT_VAR match_opcode = 40 check_headers = 1 savebonus = ~-2~ END

      PATCH_FOR_EACH offset IN 0xc 0x54 BEGIN
        READ_LONG ~%offset%~ desc_strref
            PATCH_IF (desc_strref >= 0 && desc_strref < 2147483646) BEGIN
              READ_STRREF ~%offset%~ desc
              INNER_PATCH_SAVE desc ~%desc%~ BEGIN
                REPLACE_TEXTUALLY ~%oldmace5%~ ~%newmace5%~
                REPLACE_TEXTUALLY ~%oldmace1%~ ~%newmace1%~
                REPLACE_TEXTUALLY ~%oldmace2%~ ~%newmace2%~
                REPLACE_TEXTUALLY ~%oldmace3%~ ~%newmace3%~
              END
              SAY_EVALUATED ~%offset%~ ~%desc%~
            END
      END
END

///////////////////////////////////////////////////////////////////////////
// Krotan's Skullcrusher                                                 //
// +5% crit strike for this weapon                                       //
///////////////////////////////////////////////////////////////////////////
ACTION_IF FILE_EXISTS_IN_GAME ~BLUN11.ITM~ BEGIN
OUTER_SPRINT oldmace4 @30806
OUTER_SPRINT newmace4 @30807

    COPY_EXISTING ~BLUN11.ITM~ ~override~
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 301 target = 1 parameter1 = 1 parameter2 = 1 timing = 2 resist_dispel = 0 probability1 = 100 END

      READ_LONG 0x54 desc_strref
          PATCH_IF (desc_strref >= 0 && desc_strref < 2147483646) BEGIN
            READ_STRREF 0x54 desc
            INNER_PATCH_SAVE desc ~%desc%~ BEGIN
              REPLACE_TEXTUALLY ~%oldmace4%~ ~%newmace4%~
            END
            SAY_EVALUATED 0x54 ~%desc%~
          END
END

///////////////////////////////////////////////////////////////////////////
// Storm Star +5                                                         //
// +2d4+1 electrical damage                                                //
// 10% chance of chain lightning                                         //
///////////////////////////////////////////////////////////////////////////
ACTION_IF FILE_EXISTS_IN_GAME ~BLUN29.ITM~ BEGIN
OUTER_SPRINT oldmace6 @30810
OUTER_SPRINT newmace6 @30811
OUTER_SPRINT oldmace7 @30812
OUTER_SPRINT newmace7 @30813

    COPY_EXISTING ~BLUN29.ITM~ ~override~
      LPF ALTER_ITEM_EFFECT INT_VAR match_opcode = 146 check_headers = 1 probability1 = 9 END
      LPF ALTER_ITEM_EFFECT INT_VAR check_headers = 1 match_opcode = 12 parameter1 = 1 dicenumber = 2 dicesize = 4 END

      READ_LONG 0x54 desc_strref
          PATCH_IF (desc_strref >= 0 && desc_strref < 2147483646) BEGIN
            READ_STRREF 0x54 desc
            INNER_PATCH_SAVE desc ~%desc%~ BEGIN
              REPLACE_TEXTUALLY ~%oldmace6%~ ~%newmace6%~
              REPLACE_TEXTUALLY ~%oldmace7%~ ~%newmace7%~
            END
            SAY_EVALUATED 0x54 ~%desc%~
          END
END

///////////////////////////////////////////////////////////////////////////
// Skullcrusher                                                          //
// +10% crit strike with this weapon                                     //
///////////////////////////////////////////////////////////////////////////
ACTION_IF FILE_EXISTS_IN_GAME ~BLUN18.ITM~ BEGIN
OUTER_SPRINT oldmace8 @30814
OUTER_SPRINT newmace8 @30815
    
    COPY_EXISTING ~BLUN18.ITM~ ~override~
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 301 target = 1 parameter1 = 2 parameter2 = 1 timing = 2 resist_dispel = 0 probability1 = 100 END

      READ_LONG 0x54 desc_strref
          PATCH_IF (desc_strref >= 0 && desc_strref < 2147483646) BEGIN
            READ_STRREF 0x54 desc
            INNER_PATCH_SAVE desc ~%desc%~ BEGIN
              REPLACE_TEXTUALLY ~%oldmace8%~ ~%newmace8%~
            END
            SAY_EVALUATED 0x54 ~%desc%~
          END
END

///////////////////////////////////////////////////////////////////////////
// Soldier's Might +2 & Petty's Tempest +2                               //
// +1d4 elemental damage (previously +1)                                 //
///////////////////////////////////////////////////////////////////////////
ACTION_IF FILE_EXISTS_IN_GAME ~MOBLN02.ITM~ AND FILE_EXISTS_IN_GAME ~MOBLN01.ITM~ BEGIN
OUTER_SPRINT oldmace9 @30816
OUTER_SPRINT newmace9 @30817
    
    ACTION_FOR_EACH blunt IN 1 2 BEGIN
      COPY_EXISTING ~MOBLN0%blunt%.ITM~ ~override~
        LPF ALTER_ITEM_EFFECT INT_VAR check_headers = 1 match_opcode = 12 parameter1 = 0 dicenumber = 1 dicesize = 4 END

        READ_LONG 0x54 desc_strref
            PATCH_IF (desc_strref >= 0 && desc_strref < 2147483646) BEGIN
              READ_STRREF 0x54 desc
              INNER_PATCH_SAVE desc ~%desc%~ BEGIN
                REPLACE_TEXTUALLY ~%oldmace9%~ ~%newmace9%~
              END
              SAY_EVALUATED 0x54 ~%desc%~
            END
    END

END

///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
// Morning Star                                                          //
///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////
// The Sleeper +2                                                        //
// -2 bonus to save (previously +4 bonus)                                //
///////////////////////////////////////////////////////////////////////////
ACTION_IF FILE_EXISTS_IN_GAME ~BLUN16.ITM~ BEGIN
OUTER_SPRINT oldmorning1 @30900
OUTER_SPRINT newmorning1 @30901

    COPY_EXISTING ~BLUN16.ITM~ ~override~
      LPF ALTER_ITEM_EFFECT INT_VAR match_opcode = 177 check_headers = 1 savebonus = ~-2~ END

      READ_LONG 0x54 desc_strref
          PATCH_IF (desc_strref >= 0 && desc_strref < 2147483646) BEGIN
            READ_STRREF 0x54 desc
            INNER_PATCH_SAVE desc ~%desc%~ BEGIN
              REPLACE_TEXTUALLY ~%oldmorning1%~ ~%newmorning1%~
            END
            SAY_EVALUATED 0x54 ~%desc%~
          END
END

///////////////////////////////////////////////////////////////////////////
// Ice Star +4                                                           //
// +1d8 cold damage (previously +1d4)                                    //
///////////////////////////////////////////////////////////////////////////
ACTION_IF FILE_EXISTS_IN_GAME ~BLUN35.ITM~ BEGIN
OUTER_SPRINT oldmorning2 @30902
OUTER_SPRINT newmorning2 @30903

    COPY_EXISTING ~BLUN35.ITM~ ~override~
      LPF ALTER_ITEM_EFFECT INT_VAR check_headers = 1 match_opcode = 12 parameter1 = 0 dicenumber = 1 dicesize = 8 END

      READ_LONG 0x54 desc_strref
          PATCH_IF (desc_strref >= 0 && desc_strref < 2147483646) BEGIN
            READ_STRREF 0x54 desc
            INNER_PATCH_SAVE desc ~%desc%~ BEGIN
              REPLACE_TEXTUALLY ~%oldmorning2%~ ~%newmorning2%~
            END
            SAY_EVALUATED 0x54 ~%desc%~
          END
END

///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
// Ninja-To                                                              //
///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////
// Usuno's Blade +4                                                      //
///////////////////////////////////////////////////////////////////////////
ACTION_IF FILE_EXISTS_IN_GAME ~SW1H67.ITM~ BEGIN
OUTER_SPRINT oldninja1 @31000
OUTER_SPRINT newninja1 @31001

    COPY_EXISTING ~SW1H67.ITM~ ~override~
      LPF CLONE_EFFECT INT_VAR match_opcode = 12 opcode = 12 probability1 = 100 dicenumber = 1 dicesize = 8 savingthrow = 0 special = 0 END

      READ_LONG 0x54 desc_strref
          PATCH_IF (desc_strref >= 0 && desc_strref < 2147483646) BEGIN
            READ_STRREF 0x54 desc
            INNER_PATCH_SAVE desc ~%desc%~ BEGIN
              REPLACE_TEXTUALLY ~%oldninja1%~ ~%newninja1%~
            END
            SAY_EVALUATED 0x54 ~%desc%~
          END

END

///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
// Staff                                                                 //
///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////
// Cleric's Staff +3                                                     //
// +2 Wisdom                                                             //
///////////////////////////////////////////////////////////////////////////
ACTION_IF FILE_EXISTS_IN_GAME ~STAF19.ITM~ BEGIN
OUTER_SPRINT oldstaff1 @31100
OUTER_SPRINT newstaff1 @31101

    COPY_EXISTING ~STAF19.ITM~ ~override~
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 49 target = 1 parameter1 = 2 parameter2 = 0 timing = 2 resist_dispel = 2 probability1 = 100 END

      READ_LONG 0x54 desc_strref
          PATCH_IF (desc_strref >= 0 && desc_strref < 2147483646) BEGIN
            READ_STRREF 0x54 desc
            INNER_PATCH_SAVE desc ~%desc%~ BEGIN
              REPLACE_TEXTUALLY ~%oldstaff1%~ ~%newstaff1%~
            END
            SAY_EVALUATED 0x54 ~%desc%~
          END
END

///////////////////////////////////////////////////////////////////////////
// Martial Staff +3                                                      //
// AC: +1 Bonus, Regenerate 1 Hit Point per round                        //
///////////////////////////////////////////////////////////////////////////
ACTION_IF FILE_EXISTS_IN_GAME ~STAF08.ITM~ BEGIN
OUTER_SPRINT oldstaff2 @31102
OUTER_SPRINT newstaff2 @31103

    COPY_EXISTING ~STAF08.ITM~ ~override~
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 142 target = 1 parameter2 = 87 timing = 2 resist_dispel = 0 probability1 = 100 END
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 98 target = 1 parameter1 = 6 parameter2 = 3 timing = 2 resist_dispel = 0 probability1 = 100 END
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 0 target = 1 parameter1 = 1 timing = 2 resist_dispel = 0 probability1 = 100 END

      READ_LONG 0x54 desc_strref
          PATCH_IF (desc_strref >= 0 && desc_strref < 2147483646) BEGIN
            READ_STRREF 0x54 desc
            INNER_PATCH_SAVE desc ~%desc%~ BEGIN
              REPLACE_TEXTUALLY ~%oldstaff2%~ ~%newstaff2%~
            END
            SAY_EVALUATED 0x54 ~%desc%~
          END
END

///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
// Scimitar                                                              //
///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////
// Rashad Talon                                                          //
// +1d6 Slashing on Crit                                                 //
///////////////////////////////////////////////////////////////////////////
ACTION_IF FILE_EXISTS_IN_GAME ~SW1H23.ITM~ BEGIN
COPY ~forgotten-armament/eff/update_item/MO1H23.EFF~ ~override~
OUTER_SPRINT oldscimi1 @31200
OUTER_SPRINT newscimi1 @31201

    COPY_EXISTING ~SW1H23.ITM~ ~override~
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 341 target = 1 parameter1 = 1 parameter2 = 1 timing = 2 resist_dispel = 0 probability1 = 100 STR_VAR resource = ~mo1h23~ END

      READ_LONG 0x54 desc_strref
          PATCH_IF (desc_strref >= 0 && desc_strref < 2147483646) BEGIN
            READ_STRREF 0x54 desc
            INNER_PATCH_SAVE desc ~%desc%~ BEGIN
              REPLACE_TEXTUALLY ~%oldscimi1%~ ~%newscimi1%~
            END
            SAY_EVALUATED 0x54 ~%desc%~
          END
END

///////////////////////////////////////////////////////////////////////////
// Spectral Brand +5                                                     //
// Replace Piercing Strike with Critical Strike                          //
///////////////////////////////////////////////////////////////////////////
ACTION_IF FILE_EXISTS_IN_GAME ~SW1H69.ITM~ BEGIN
OUTER_SPRINT oldscimi2 @31202
OUTER_SPRINT newscimi2 @31203
OUTER_SPRINT oldscimi3 @31204
OUTER_SPRINT newscimi3 @31205
OUTER_SPRINT oldscimi4 @31206
OUTER_SPRINT newscimi4 @31207
OUTER_SPRINT oldscimi6 @31210
OUTER_SPRINT newscimi6 @31211


    COPY_EXISTING ~SW1H69.ITM~ ~override~
      LPF ALTER_ITEM_EFFECT INT_VAR match_opcode = 142 check_headers = 1 parameter2 = 152 duration = 6 END
      LPF ALTER_ITEM_EFFECT INT_VAR match_opcode = 54 check_headers = 1 new_opcode = 301 parameter1 = 20 duration = 6 END
      LPF ALTER_ITEM_EFFECT INT_VAR match_opcode = 215 check_headers = 1 target = 2 STR_VAR resource = ~sppowatk~ END
      LPF CLONE_EFFECT INT_VAR match_opcode = 301 opcode = 282 parameter2 = 3 END
      LPF CLONE_EFFECT INT_VAR match_opcode = 142 opcode = 174 timing = 1 duration = 0 STR_VAR resource = ~eff_p82~ END
      LPF CLONE_EFFECT INT_VAR match_opcode = 142 opcode = 174 timing = 4 duration = 12 STR_VAR resource = ~eff_e01~ END
      LPF ALTER_ITEM_EFFECT INT_VAR check_headers = 1 match_opcode = 12 parameter1 = 1 dicenumber = 2 dicesize = 4 END

      READ_LONG 0x64 hf //Extended header offset
      READ_SHORT 0x68 hc //Extended header count
      FOR (i1 = 0; i1 < hc; i1 += 1) BEGIN //Cycle through headers
        READ_BYTE (0x38 * i1 + hf) pt //Attack type
        PATCH_IF pt = 3 BEGIN
          READ_ASCII (0x38 * i1 + hf + 4) icon
          PATCH_IF ("%icon%" STRING_EQUAL_CASE "SPPR313B") BEGIN
            WRITE_ASCII (0x38 * i1 + hf + 4) ~spcl905b~ #8
          END
        END
      END

      READ_LONG 0x54 desc_strref
          PATCH_IF (desc_strref >= 0 && desc_strref < 2147483646) BEGIN
            READ_STRREF 0x54 desc
            INNER_PATCH_SAVE desc ~%desc%~ BEGIN
              REPLACE_TEXTUALLY ~%oldscimi2%~ ~%newscimi2%~
              REPLACE_TEXTUALLY ~%oldscimi3%~ ~%newscimi3%~
              REPLACE_TEXTUALLY ~%oldscimi4%~ ~%newscimi4%~
              REPLACE_TEXTUALLY ~%oldscimi6%~ ~%newscimi6%~
            END
            SAY_EVALUATED 0x54 ~%desc%~
          END
    
    ACTION_GET_STRREF ~70621~ pierce_strike

    OUTER_PATCH_SAVE pierce_strike ~%pierce_strike%~ BEGIN
      REPLACE_TEXTUALLY ~%oldscimi2%~ ~%newscimi2%~
    END

    STRING_SET_EVALUATE ~70621~ ~%pierce_strike%~
END

///////////////////////////////////////////////////////////////////////////
// Water's Edge +3                                                       //
// +5% crit chance with this weapon                                      //
///////////////////////////////////////////////////////////////////////////
ACTION_IF FILE_EXISTS_IN_GAME ~SW1H52.ITM~ BEGIN
OUTER_SPRINT oldscimi5 @31208
OUTER_SPRINT newscimi5 @31209

    COPY_EXISTING ~SW1H52.ITM~ ~override~
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 301 target = 1 parameter1 = 1 parameter2 = 1 timing = 2 resist_dispel = 0 probability1 = 100 END

      READ_LONG 0x54 desc_strref
          PATCH_IF (desc_strref >= 0 && desc_strref < 2147483646) BEGIN
            READ_STRREF 0x54 desc
            INNER_PATCH_SAVE desc ~%desc%~ BEGIN
              REPLACE_TEXTUALLY ~%oldscimi5%~ ~%newscimi5%~
            END
            SAY_EVALUATED 0x54 ~%desc%~
          END
END

///////////////////////////////////////////////////////////////////////////
// Spectral Brand +4                                                     //
// +1d8 cold damage (previously 1d4)                                     //
///////////////////////////////////////////////////////////////////////////
ACTION_IF FILE_EXISTS_IN_GAME ~SW1H68.ITM~ BEGIN
OUTER_SPRINT oldscimi7 @31212
OUTER_SPRINT newscimi7 @31213

    COPY_EXISTING ~SW1H68.ITM~ ~override~
      LPF ALTER_ITEM_EFFECT INT_VAR check_headers = 1 match_opcode = 12 dicenumber = 1 dicesize = 8 END

      READ_LONG 0x54 desc_strref
          PATCH_IF (desc_strref >= 0 && desc_strref < 2147483646) BEGIN
            READ_STRREF 0x54 desc
            INNER_PATCH_SAVE desc ~%desc%~ BEGIN
              REPLACE_TEXTUALLY ~%oldscimi7%~ ~%newscimi7%~
            END
            SAY_EVALUATED 0x54 ~%desc%~
          END
END

///////////////////////////////////////////////////////////////////////////
// Laughing Blade +2                                                     //
// +1d4 cold damage (previously +1)                                      //
///////////////////////////////////////////////////////////////////////////
ACTION_IF FILE_EXISTS_IN_GAME ~MO1H30.ITM~ BEGIN
OUTER_SPRINT oldscimi8 @31214
OUTER_SPRINT newscimi8 @31215

    COPY_EXISTING ~MO1H30.ITM~ ~override~
      LPF ALTER_ITEM_EFFECT INT_VAR check_headers = 1 match_opcode = 12 parameter1 = 0 dicenumber = 1 dicesize = 4 END

      READ_LONG 0x54 desc_strref
          PATCH_IF (desc_strref >= 0 && desc_strref < 2147483646) BEGIN
            READ_STRREF 0x54 desc
            INNER_PATCH_SAVE desc ~%desc%~ BEGIN
              REPLACE_TEXTUALLY ~%oldscimi8%~ ~%newscimi8%~
            END
            SAY_EVALUATED 0x54 ~%desc%~
          END
END

///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
// Short Sword                                                           //
///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////
// Cutthroat +4                                                          //
// Inflicts 2 points of bleeding damage per hit (one point per round)    //
///////////////////////////////////////////////////////////////////////////
ACTION_IF FILE_EXISTS_IN_GAME ~SW1H28.ITM~ BEGIN
OUTER_SPRINT oldshort1 @31300
OUTER_SPRINT newshort1 @31301

    COPY_EXISTING ~SW1H28.ITM~ ~override~
      LPF ADD_ITEM_EFFECT INT_VAR opcode = 146 type = 1 target = 2 parameter1 = 1 parameter2 = 1 timing = 1 resist_dispel = 0 probability1 = 100 STR_VAR resource = ~bdsw1h21~ END

      READ_LONG 0x54 desc_strref
          PATCH_IF (desc_strref >= 0 && desc_strref < 2147483646) BEGIN
            READ_STRREF 0x54 desc
            INNER_PATCH_SAVE desc ~%desc%~ BEGIN
              REPLACE_TEXTUALLY ~%oldshort1%~ ~%newshort1%~
            END
            SAY_EVALUATED 0x54 ~%desc%~
          END
END

///////////////////////////////////////////////////////////////////////////
// Short Sword of Mask                                                   //
// Non-Detection, Remove Level Drain, 5% chance of proccing assassination//
///////////////////////////////////////////////////////////////////////////
ACTION_IF FILE_EXISTS_IN_GAME ~SW1H58.ITM~ AND FILE_EXISTS_IN_GAME ~SW1H59.ITM~ BEGIN
OUTER_SPRINT oldshort2 @31302
OUTER_SPRINT newshort2 @31303
OUTER_SPRINT oldshort3 @31304
OUTER_SPRINT newshort3 @31305

    COPY_EXISTING ~SW1H58.ITM~ ~override~
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 69 target = 1 timing = 2 resist_dispel = 0 probability1 = 100 END
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 142 target = 1 parameter2 = 31 timing = 2 resist_dispel = 0 probability1 = 100 END

      READ_LONG 0x54 desc_strref
          PATCH_IF (desc_strref >= 0 && desc_strref < 2147483646) BEGIN
            READ_STRREF 0x54 desc
            INNER_PATCH_SAVE desc ~%desc%~ BEGIN
              REPLACE_TEXTUALLY ~%oldshort2%~ ~%newshort2%~
            END
            SAY_EVALUATED 0x54 ~%desc%~
          END

    COPY_EXISTING ~SW1H59.ITM~ ~override~
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 69 target = 1 timing = 2 resist_dispel = 0 probability1 = 100 END
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 142 target = 1 parameter2 = 31 timing = 2 resist_dispel = 0 probability1 = 100 END
      LPF DELETE_EFFECT INT_VAR header_type = 1 match_opcode = 139 END
      LPF DELETE_EFFECT INT_VAR header_type = 1 match_opcode = 216 END
      LPF DELETE_EFFECT INT_VAR header_type = 1 match_opcode = 141 END
      LPF ADD_ITEM_EFFECT INT_VAR opcode = 303 type = 1 target = 1 parameter2 = 1 timing = 0 resist_dispel = 2 duration = 6 probability1 = 100 probability2 = 95 END
      LPF ADD_ITEM_EFFECT INT_VAR opcode = 142 type = 1 target = 1 parameter2 = 156 timing = 0 resist_dispel = 2 duration = 6 probability1 = 100 probability2 = 95 END
      LPF ADD_ITEM_EFFECT INT_VAR opcode = 282 type = 1 target = 1 parameter1 = 4 parameter2 = 3 timing = 0 resist_dispel = 2 duration = 6 probability1 = 100 probability2 = 95 END
      LPF ADD_ITEM_EFFECT INT_VAR opcode = 174 type = 1 target = 1 timing = 4 resist_dispel = 2 duration = 6 probability1 = 100 probability2 = 95 STR_VAR resource = ~eff_e01~ END
      LPF ADD_ITEM_EFFECT INT_VAR opcode = 174 type = 1 target = 1 timing = 1 resist_dispel = 2 duration = 0 probability1 = 100 probability2 = 95 STR_VAR resource = ~wwattack~ END
      LPF ADD_ITEM_EFFECT INT_VAR opcode = 215 type = 1 target = 2 parameter2 = 0 timing = 1 resist_dispel = 0 duration = 0 probability1 = 100 probability2 = 95 STR_VAR resource = ~spgrwhrl~ END

      READ_LONG 0x54 desc_strref
          PATCH_IF (desc_strref >= 0 && desc_strref < 2147483646) BEGIN
            READ_STRREF 0x54 desc
            INNER_PATCH_SAVE desc ~%desc%~ BEGIN
              REPLACE_TEXTUALLY ~%oldshort2%~ ~%newshort2%~
              REPLACE_TEXTUALLY ~%oldshort3%~ ~%newshort3%~
            END
            SAY_EVALUATED 0x54 ~%desc%~
          END
END

///////////////////////////////////////////////////////////////////////////
// The Shadow's Blade +3                                                 //
// Luck +1, +1 Backstab (Thieves only)                                   //
///////////////////////////////////////////////////////////////////////////
ACTION_IF FILE_EXISTS_IN_GAME ~SW1H10.ITM~ BEGIN
COPY ~forgotten-armament/eff/update_item/MO1H10.EFF~ ~override~
OUTER_SPRINT oldshort4 @31306
OUTER_SPRINT newshort4 @31307

    COPY_EXISTING ~SW1H10.ITM~ ~override~
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 22 target = 1 parameter1 = 1 parameter2 = 0 timing = 2 resist_dispel = 0 probability1 = 100 END
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 177 target = 1 parameter1 = 205 parameter2 = 5 timing = 2 resist_dispel = 0 probability1 = 100 STR_VAR resource = ~mo1h10~ END

      READ_LONG 0x54 desc_strref
          PATCH_IF (desc_strref >= 0 && desc_strref < 2147483646) BEGIN
            READ_STRREF 0x54 desc
            INNER_PATCH_SAVE desc ~%desc%~ BEGIN
              REPLACE_TEXTUALLY ~%oldshort4%~ ~%newshort4%~
            END
            SAY_EVALUATED 0x54 ~%desc%~
          END
END

///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
// Spear                                                                 //
///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////
// Heartwood Spear +4                                                    //
// +1d8 electrical damage (previously +1d4)                              //
///////////////////////////////////////////////////////////////////////////
ACTION_IF FILE_EXISTS_IN_GAME ~MOSP02.ITM~ BEGIN
OUTER_SPRINT oldspear1 @31400
OUTER_SPRINT newspear1 @31401

    COPY_EXISTING ~MOSP02.ITM~ ~override~
      LPF ALTER_ITEM_EFFECT INT_VAR check_headers = 1 match_opcode = 12 parameter1 = 0 dicenumber = 1 dicesize = 8 END

      READ_LONG 0x54 desc_strref
          PATCH_IF (desc_strref >= 0 && desc_strref < 2147483646) BEGIN
            READ_STRREF 0x54 desc
            INNER_PATCH_SAVE desc ~%desc%~ BEGIN
              REPLACE_TEXTUALLY ~%oldspear1%~ ~%newspear1%~
            END
            SAY_EVALUATED 0x54 ~%desc%~
          END
END

///////////////////////////////////////////////////////////////////////////
// Ixil's Spike +6                                                       //
// Remove Free Action, Save vs. Paralysis at -4 negates                  //
///////////////////////////////////////////////////////////////////////////
ACTION_IF FILE_EXISTS_IN_GAME ~SPER12.ITM~ BEGIN
OUTER_SPRINT oldspear2 @31402
OUTER_SPRINT oldspear3 @31403
OUTER_SPRINT newspear3 @31404


    COPY_EXISTING ~SPER12.ITM~ ~override~
        LPF DELETE_ITEM_EQEFFECT INT_VAR opcode_to_delete = 46 END
        LPF DELETE_ITEM_EQEFFECT INT_VAR opcode_to_delete = 267 END
        LPF DELETE_ITEM_EQEFFECT INT_VAR opcode_to_delete = 142 END      
        LPF DELETE_ITEM_EQEFFECT INT_VAR opcode_to_delete = 163 END
        LPF DELETE_ITEM_EQEFFECT INT_VAR opcode_to_delete = 101 END
        LPF DELETE_ITEM_EQEFFECT INT_VAR opcode_to_delete = 296 END
        LPF DELETE_ITEM_EQEFFECT INT_VAR opcode_to_delete = 126 END
        LPF DELETE_ITEM_EQEFFECT INT_VAR opcode_to_delete = 169 END
        LPF DELETE_ITEM_EQEFFECT INT_VAR opcode_to_delete = 206 END
        LPF DELETE_ITEM_EQEFFECT INT_VAR opcode_to_delete = 162 END
        LPF DELETE_ITEM_EQEFFECT INT_VAR opcode_to_delete = 240 END
        LPF ALTER_ITEM_EFFECT INT_VAR check_headers = 1 match_opcode = 12 savebonus = ~-4~ END
        LPF ALTER_ITEM_EFFECT INT_VAR check_headers = 1 match_opcode = 39 savebonus = ~-4~ END

        READ_LONG 0x54 desc_strref
          PATCH_IF (desc_strref >= 0 && desc_strref < 2147483646) BEGIN
            READ_STRREF 0x54 desc
            INNER_PATCH_SAVE desc ~%desc%~ BEGIN
              REPLACE_TEXTUALLY ~%oldspear2%~ ~~
              REPLACE_TEXTUALLY ~%oldspear3%~ ~%newspear3%~
            END
            SAY_EVALUATED 0x54 ~%desc%~
          END
END

///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
// Two-Handed Sword                                                      //
///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////
// Carsomyr +5/+6                                                        //
// MR increments instead of sets                                         //
///////////////////////////////////////////////////////////////////////////
ACTION_IF FILE_EXISTS_IN_GAME ~SW2H10.ITM~ AND FILE_EXISTS_IN_GAME ~SW2H19.ITM~ BEGIN
OUTER_SPRINT oldtwohand1 @31500
OUTER_SPRINT newtwohand1 @31501

    ACTION_FOR_EACH carsomyr IN 10 19 BEGIN
      COPY_EXISTING ~SW2H%carsomyr%.ITM~ ~override~ 
        LPF ALTER_ITEM_EFFECT INT_VAR check_globals = 1 match_opcode = 166 parameter1 = 24 parameter2 = 0 END

        READ_LONG 0x54 desc_strref
            PATCH_IF (desc_strref >= 0 && desc_strref < 2147483646) BEGIN
              READ_STRREF 0x54 desc
              INNER_PATCH_SAVE desc ~%desc%~ BEGIN
                REPLACE_TEXTUALLY ~%oldtwohand1%~ ~%newtwohand1%~
              END
              SAY_EVALUATED 0x54 ~%desc%~
            END
    END
END

///////////////////////////////////////////////////////////////////////////
// Ir'revrykal                                                           //
// Remove Dispel on Hit and Immunity to Charm                            //
// Add vorpal strike and healing per hit                                 //
///////////////////////////////////////////////////////////////////////////
ACTION_IF FILE_EXISTS_IN_GAME ~OHREAVER.ITM~ BEGIN
OUTER_SPRINT oldtwohand2 @31502
OUTER_SPRINT newtwohand2 @31503

    COPY_EXISTING ~OHREAVER.ITM~ ~override~
      LPF DELETE_EFFECT INT_VAR header_type = 1 match_opcode = 81 END
      LPF DELETE_EFFECT INT_VAR header_type = 1 match_opcode = 77 END
      LPF DELETE_EFFECT INT_VAR header_type = 1 match_opcode = 58 END
      LPF DELETE_EFFECT INT_VAR header_type = 1 match_opcode = 139 END
      LPF DELETE_EFFECT INT_VAR header_type = 1 match_opcode = 215 END
      LPF DELETE_EFFECT INT_VAR header_type = 1 match_opcode = 240 END
      LPF DELETE_EFFECT INT_VAR header_type = 1 match_opcode = 177 END
      LPF DELETE_EFFECT INT_VAR header_type = 1 match_opcode = 267 END
      LPF DELETE_EFFECT INT_VAR header_type = 1 match_opcode = 101 END
      LPF DELETE_EFFECT INT_VAR header_type = 1 match_opcode = 142 END
      LPF DELETE_EFFECT INT_VAR header_type = 1 match_opcode = 296 END
      LPF DELETE_EFFECT INT_VAR header_type = 1 match_opcode = 169 END
      LPF ADD_ITEM_EFFECT INT_VAR opcode = 12 type = 1 parameter1 = 5 parameter2 = 4194304 timing = 1 resist_dispel = 0 probability1 = 100 special = 1 END
      LPF ADD_ITEM_EFFECT INT_VAR opcode = 139 type = 1 target = 2 parameter1 = 64285 timing = 9 resist_dispel = 2 probability1 = 10 savingthrow = 4 savebonus = ~-4~ END
      LPF ADD_ITEM_EFFECT INT_VAR opcode = 13 type = 1 target = 2 parameter1 = 0 parameter2 = 8 timing = 1 resist_dispel = 2 probability1 = 10 savingthrow = 4 savebonus = ~-4~ END
      LPF ADD_ITEM_EFFECT INT_VAR opcode = 141 type = 1 target = 2 parameter1 = 0 parameter2 = 39 timing = 1 resist_dispel = 2 probability1 = 10 savingthrow = 4 savebonus = ~-4~ END

      READ_LONG 0x54 desc_strref
          PATCH_IF (desc_strref >= 0 && desc_strref < 2147483646) BEGIN
            READ_STRREF 0x54 desc
            INNER_PATCH_SAVE desc ~%desc%~ BEGIN
              REPLACE_TEXTUALLY ~%oldtwohand2%~ ~%newtwohand2%~
            END
            SAY_EVALUATED 0x54 ~%desc%~
          END
END

///////////////////////////////////////////////////////////////////////////
// Greater Silver Sword                                                  //
// +4 weapon, -4 to save, immunity psionics                              //
///////////////////////////////////////////////////////////////////////////
ACTION_IF FILE_EXISTS_IN_GAME ~SW2H15.ITM~ BEGIN

    COPY_EXISTING ~SW2H15.ITM~ ~override\MO2H15.ITM~
      WRITE_LONG 0x60 4
      LPF ALTER_ITEM_HEADER INT_VAR header_type=1 thac0_bonus = 4 damage_bonus = 4 END
      LPF ALTER_ITEM_EFFECT INT_VAR match_opcode = ~-1~ check_headers = 1 savebonus = ~-4~ END
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 267 target = 1 parameter1 = 14780 timing = 2 resist_dispel = 0 probability1 = 100 END
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 267 target = 1 parameter1 = 14672 timing = 2 resist_dispel = 0 probability1 = 100 END
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 267 target = 1 parameter1 = 8364 timing = 2 resist_dispel = 0 probability1 = 100 END
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 267 target = 1 parameter1 = 14791 timing = 2 resist_dispel = 2 probability1 = 100 END
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 267 target = 1 parameter1 = 14782 timing = 2 resist_dispel = 2 probability1 = 100 END
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 142 target = 1 parameter2 = 52 timing = 2 resist_dispel = 2 probability1 = 100 END
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 142 target = 1 parameter2 = 52 timing = 2 resist_dispel = 0 probability1 = 100 END
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 101 target = 1 parameter2 = 5 timing = 2 resist_dispel = 0 probability1 = 100 END
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 101 target = 1 parameter2 = 128 timing = 2 resist_dispel = 2 probability1 = 100 END
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 296 target = 1 timing = 2 resist_dispel = 0 probability1 = 100 STR_VAR resource = ~spnwchrm~ END
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 296 target = 1 timing = 2 resist_dispel = 2 probability1 = 100 STR_VAR resource = ~spflayer~ END
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 296 target = 1 timing = 2 resist_dispel = 2 probability1 = 100 STR_VAR resource = ~spconfus~ END
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 169 target = 1 parameter2 = 0 timing = 2 resist_dispel = 0 probability1 = 100 END
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 169 target = 1 parameter2 = 1 timing = 2 resist_dispel = 0 probability1 = 100 END
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 169 target = 1 parameter2 = 43 timing = 2 resist_dispel = 0 probability1 = 100 END
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 169 target = 1 parameter2 = 47 timing = 2 resist_dispel = 2 probability1 = 100 END
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 169 target = 1 parameter2 = 2 timing = 2 resist_dispel = 2 probability1 = 100 END
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 169 target = 1 parameter2 = 3 timing = 2 resist_dispel = 2 probability1 = 100 END
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 206 target = 1 timing = 2 resist_dispel = 2 probability1 = 100 STR_VAR resource = ~spin975~ END
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 206 target = 1 timing = 2 resist_dispel = 2 probability1 = 100 STR_VAR resource = ~spin974~ END
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 206 target = 1 timing = 2 resist_dispel = 2 probability1 = 100 STR_VAR resource = ~spin912~ END
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 206 target = 1 timing = 2 resist_dispel = 2 probability1 = 100 STR_VAR resource = ~spin911~ END
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 206 target = 1 timing = 2 resist_dispel = 2 probability1 = 100 STR_VAR resource = ~spin909~ END
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 206 target = 1 timing = 2 resist_dispel = 2 probability1 = 100 STR_VAR resource = ~spin910~ END
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 206 target = 1 timing = 2 resist_dispel = 2 probability1 = 100 STR_VAR resource = ~spin959~ END
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 206 target = 1 timing = 2 resist_dispel = 2 probability1 = 100 STR_VAR resource = ~spin834~ END
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 206 target = 1 timing = 2 resist_dispel = 2 probability1 = 100 STR_VAR resource = ~spin774~ END
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 206 target = 1 timing = 2 resist_dispel = 2 probability1 = 100 STR_VAR resource = ~spin775~ END
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 206 target = 1 timing = 2 resist_dispel = 2 probability1 = 100 STR_VAR resource = ~sppr709~ END
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 206 target = 1 timing = 2 resist_dispel = 2 probability1 = 100 STR_VAR resource = ~spwi401~ END
      SAY NAME1 @31504
      SAY NAME2 @31504
      SAY DESC  @31505
END

///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
// Wakizashi                                                             //
///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////
// Yamato +4                                                             //
// +1 APR                                                                //
///////////////////////////////////////////////////////////////////////////
ACTION_IF FILE_EXISTS_IN_GAME ~SW1H66.ITM~ BEGIN
OUTER_SPRINT oldyamato @31600
OUTER_SPRINT newyamato @31601

    COPY_EXISTING ~SW1H66.ITM~ ~override~ 
      LPF ADD_ITEM_EQEFFECT INT_VAR opcode = 1 target = 1 parameter1 = 1 parameter2 = 0 timing = 2 resist_dispel = 0 probability1 = 100 END

      READ_LONG 0x54 desc_strref
          PATCH_IF (desc_strref >= 0 && desc_strref < 2147483646) BEGIN
            READ_STRREF 0x54 desc
            INNER_PATCH_SAVE desc ~%desc%~ BEGIN
              REPLACE_TEXTUALLY ~%oldyamato%~ ~%newyamato%~
            END
            SAY_EVALUATED 0x54 ~%desc%~
          END
END

///////////////////////////////////////////////////////////////////////////
// Kachiko's Wakizashi +3                                                //
// Increase duration of drain from round to turns                        //
///////////////////////////////////////////////////////////////////////////
ACTION_IF FILE_EXISTS_IN_GAME ~WAWAK.ITM~ BEGIN
OUTER_SPRINT oldwaki1 @31602
OUTER_SPRINT newwaki1 @31603

    COPY_EXISTING ~WAWAK.ITM~ ~override~ 
      LPF ALTER_ITEM_EFFECT INT_VAR match_opcode = 142 check_headers = 1 duration = 120 END
      LPF ALTER_ITEM_EFFECT INT_VAR match_opcode = 49 check_headers = 1 duration = 120 END

      READ_LONG 0x54 desc_strref
          PATCH_IF (desc_strref >= 0 && desc_strref < 2147483646) BEGIN
            READ_STRREF 0x54 desc
            INNER_PATCH_SAVE desc ~%desc%~ BEGIN
              REPLACE_TEXTUALLY ~%oldwaki1%~ ~%newwaki1%~
            END
            SAY_EVALUATED 0x54 ~%desc%~
          END
END

// Gram Sword of Grief becomes +4 then +5 for upgraded. 
// Dakkon Zerth 5% chance per hit of restoring a spell
// Bracers: Mintassan's Miraculous Bracers, Red Guard, Clasps of the Devoted, Bracers of the Inner Planes